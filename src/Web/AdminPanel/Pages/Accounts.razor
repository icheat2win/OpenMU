@page "/accounts"
@using MUnique.OpenMU.Web.AdminPanel.Services
@using MUnique.OpenMU.DataModel.Entities;
@using MUnique.OpenMU.Persistence;

@inject AccountService _accountService;

<PageTitle>OpenMU: Accounts</PageTitle>
<Breadcrumb IsFirstFromRoot="true" Caption="Accounts" />

<div class="min-h-screen bg-slate-50 dark:bg-slate-900 py-6">
    <!-- Header -->
    <div class="mb-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
            <h1 class="text-4xl font-bold text-slate-900 dark:text-white flex items-center gap-3 mb-2">
                <span class="text-3xl">👤</span>
                Account Management
            </h1>
            <p class="text-slate-600 dark:text-slate-300 text-lg">Manage player accounts and user credentials</p>
        </div>
        <button type="button" class="px-6 py-3 bg-gradient-to-r from-emerald-500 to-green-500 hover:from-emerald-600 hover:to-green-600 text-white rounded-lg font-semibold shadow-lg hover:shadow-xl transition-all flex items-center gap-2" @onclick="@this._accountService.CreateNewInModalDialogAsync">
            <span class="text-xl">➕</span> Create Account
        </button>
    </div>

    <!-- Accounts Table Card -->
    <div class="bg-white dark:bg-slate-800 rounded-xl shadow-lg border border-slate-200 dark:border-slate-700 overflow-hidden">
        <div class="p-6 border-b border-slate-200 dark:border-slate-700">
            <h2 class="text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-2">
                <span>📋</span> Accounts
            </h2>
        </div>
        
        <div class="overflow-x-auto">
            <DataTable TItem=@Account>
                <TableHeader>
                    <th class="px-6 py-4 bg-slate-50 dark:bg-slate-700 text-left">
                        <div class="flex items-center gap-2 text-sm font-semibold text-slate-700 dark:text-slate-200 uppercase tracking-wider">
                            <span>👤</span>
                            <span>Login Name</span>
                        </div>
                    </th>
                    <th class="px-6 py-4 bg-slate-50 dark:bg-slate-700 text-left">
                        <div class="flex items-center gap-2 text-sm font-semibold text-slate-700 dark:text-slate-200 uppercase tracking-wider">
                            <span>🔒</span>
                            <span>State</span>
                        </div>
                    </th>
                    <th class="px-6 py-4 bg-slate-50 dark:bg-slate-700 text-left">
                        <div class="flex items-center gap-2 text-sm font-semibold text-slate-700 dark:text-slate-200 uppercase tracking-wider">
                            <span>📧</span>
                            <span>E-Mail</span>
                        </div>
                    </th>
                    <th class="px-6 py-4 bg-slate-50 dark:bg-slate-700 text-right">
                        <div class="flex items-center justify-end gap-2 text-sm font-semibold text-slate-700 dark:text-slate-200 uppercase tracking-wider">
                            <span>⚙️</span>
                            <span>Actions</span>
                        </div>
                    </th>
                </TableHeader>
                <ItemTemplate Context="item">
                    <td class="px-6 py-4 border-b border-slate-200 dark:border-slate-700">
                        <span class="text-slate-900 dark:text-white font-medium">@item.LoginName</span>
                    </td>
                    <td class="px-6 py-4 border-b border-slate-200 dark:border-slate-700">
                        <StatBadge Value="@GetAccountStateText(item.State)" Color="@GetAccountStateBadgeColor(item.State)" />
                    </td>
                    <td class="px-6 py-4 border-b border-slate-200 dark:border-slate-700">
                        <span class="text-slate-600 dark:text-slate-300">@(string.IsNullOrEmpty(item.EMail) ? "—" : item.EMail)</span>
                    </td>
                    <td class="px-6 py-4 border-b border-slate-200 dark:border-slate-700 text-right">
                        <NavLink href="@($"edit-account/{item.GetId()}/{typeof(Account).FullName}/{item.GetId()}")" class="inline-flex items-center gap-2 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors">
                            <span>✏️</span> Edit
                        </NavLink>
                    </td>
                </ItemTemplate>
            </DataTable>
        </div>
    </div>
</div>

@code {
    private string GetAccountStateBadgeColor(AccountState state)
    {
        return state switch
        {
            AccountState.Normal => "success",
            AccountState.Banned => "danger",
            AccountState.TemporarilyBanned => "warning",
            _ => "default"
        };
    }

    private string GetAccountStateText(AccountState state)
    {
        return state switch
        {
            AccountState.Normal => "Active",
            AccountState.Banned => "Banned",
            AccountState.TemporarilyBanned => "Temp Banned",
            _ => state.ToString()
        };
    }
}
