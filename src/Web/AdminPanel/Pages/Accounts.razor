@page "/accounts"
@using MUnique.OpenMU.Web.AdminPanel.Services
@using MUnique.OpenMU.DataModel.Entities;
@using MUnique.OpenMU.Persistence;

@inject AccountService _accountService;

<PageTitle>OpenMU: Accounts</PageTitle>
<Breadcrumb IsFirstFromRoot="true" Caption="Accounts" />

<div class="page-header">
    <div class="page-title-group">
        <h1>👤 Account Management</h1>
        <p class="text-muted">Manage player accounts and user credentials</p>
    </div>
    <div class="page-actions">
        <button type="button" class="btn btn-success" @onclick="@this._accountService.CreateNewInModalDialogAsync">
            <span class="btn-icon">➕</span> Create Account
        </button>
    </div>
</div>

<div class="accounts-page">
    <ModernCard Title="Accounts" Icon="📋" CssClass="accounts-card">
        <ChildContent>
            <div class="table-wrapper">
                <DataTable TItem=@Account>
                    <TableHeader>
                        <th>
                            <div class="th-content">
                                <span class="th-icon">👤</span>
                                <span>Login Name</span>
                            </div>
                        </th>
                        <th>
                            <div class="th-content">
                                <span class="th-icon">🔒</span>
                                <span>State</span>
                            </div>
                        </th>
                        <th>
                            <div class="th-content">
                                <span class="th-icon">📧</span>
                                <span>E-Mail</span>
                            </div>
                        </th>
                        <th>
                            <div class="th-content">
                                <span class="th-icon">⚙️</span>
                                <span>Actions</span>
                            </div>
                        </th>
                    </TableHeader>
                    <ItemTemplate Context="item">
                        <td>
                            <div class="account-login">
                                <span class="account-name">@item.LoginName</span>
                            </div>
                        </td>
                        <td>
                            <StatBadge Value="@GetAccountStateText(item.State)" Color="@GetAccountStateBadgeColor(item.State)" />
                        </td>
                        <td>
                            <span class="account-email">@(string.IsNullOrEmpty(item.EMail) ? "—" : item.EMail)</span>
                        </td>
                        <td class="text-end">
                            <NavLink href="@($"edit-account/{item.GetId()}/{typeof(Account).FullName}/{item.GetId()}")" class="btn btn-sm btn-primary">
                                <span class="btn-icon">✏️</span> Edit
                            </NavLink>
                        </td>
                    </ItemTemplate>
                </DataTable>
            </div>
        </ChildContent>
    </ModernCard>
</div>

@code {
    private string GetAccountStateBadgeColor(AccountState state)
    {
        return state switch
        {
            AccountState.Normal => "success",
            AccountState.Banned => "danger",
            AccountState.TemporarilyBanned => "warning",
            _ => "default"
        };
    }

    private string GetAccountStateText(AccountState state)
    {
        return state switch
        {
            AccountState.Normal => "Active",
            AccountState.Banned => "Banned",
            AccountState.TemporarilyBanned => "Temp Banned",
            _ => state.ToString()
        };
    }
}
