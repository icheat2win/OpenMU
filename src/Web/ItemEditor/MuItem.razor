
<style>
    .mu-item { --boxSize: 42px; display: block; position: absolute; }
    .mu-item img { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); width: 180%; height: 180%; object-fit: contain; user-select: none; pointer-events: none; }
    .mu-item-selector { z-index: 100; opacity: 0; cursor: grab; transition: all 0.2s ease; }
    .mu-item-selector:active { cursor: grabbing; }
    .mu-item-selector:hover { background-color: cornflowerblue; opacity: 0.333; }
    .mu-item-selector.highlighted { background-color: greenyellow; opacity: 0.333; }
    .mu-item-selector.dragging { opacity: 0.4; cursor: grabbing; transform: scale(1.05); box-shadow: 0 8px 16px rgba(0,0,0,0.3); z-index: 200; }
    .mu-item-selector.dragging-js { opacity: 0.6; cursor: grabbing !important; transform: scale(1.1); box-shadow: 0 12px 24px rgba(0,0,0,0.4); z-index: 200; transition: transform 0.1s ease, opacity 0.1s ease; }
    .mu-item-selector.drag-over-occupied { background-color: rgba(255, 0, 0, 0.4); cursor: not-allowed !important; box-shadow: inset 0 0 0 2px rgba(255, 0, 0, 0.8); }
    .undefined-item { height: 100%; width: 100%; background-color: greenyellow; }
    .mu-item-move-arrow { position: absolute; z-index: 101; background-color: black; opacity: 0.7; }
    .mu-item-move-arrow:hover { opacity: 0.95; }
    .item-amount-label { opacity: 0.9; color: wheat; background-color: black; position: absolute; bottom: 0; right: 0; line-height: 1.1em; }
    .indicator { height: 10px; width: 10px; border-radius: 5px; position: absolute; top: 2px; opacity: 0.9; }
    .indicator.exc { background-color: lawngreen; left: 2px; }
    .indicator.anc { background-color: #00A6E2; right: 2px; }
    .indicator.socket { border: 2px solid gold; background-color: gray; right: 2px; }
    .indicator.socket.equipped { background-color: gold; }
    .indicator.socket.s1 { top: 20px; } .indicator.socket.s2 { top: 32px; } .indicator.socket.s3 { top: 44px; }
    .indicator.socket.s4 { top: 56px; } .indicator.socket.s5 { top: 68px; }
    .left { left: -24px; height: 100%; width: 24px; background-image: url('/_content/MUnique.OpenMU.Web.ItemEditor/img/light-chevron-left-48.png'); background-size: 100% 100%; }
    .right { right: -24px; height: 100%; width: 24px; background-image: url('/_content/MUnique.OpenMU.Web.ItemEditor/img/light-chevron-right-48.png'); background-size: 100% 100%; }
    .up { top: -24px; width: 100%; height: 24px; background-image: url('/_content/MUnique.OpenMU.Web.ItemEditor/img/light-chevron-up-48.png'); background-size: 100% 100%; }
    .down { bottom: -24px; width: 100%; height: 24px; background-image: url('/_content/MUnique.OpenMU.Web.ItemEditor/img/light-chevron-down-48.png'); background-size: 100% 100%; }
    .jump { background-size: 100% 50%; }
    div.h_1 { height: var(--boxSize); } div.h_2 { height: calc(var(--boxSize) * 2); } div.h_3 { height: calc(var(--boxSize) * 3); } div.h_4 { height: calc(var(--boxSize) * 4); }
    div.w_1 { width: var(--boxSize); } div.w_2 { width: calc(var(--boxSize) * 2); } div.w_3 { width: calc(var(--boxSize) * 3); } div.w_4 { width: calc(var(--boxSize) * 4); }
    div.w_5 { width: calc(var(--boxSize) * 5); } div.w_6 { width: calc(var(--boxSize) * 6); } div.w_7 { width: calc(var(--boxSize) * 7); } div.w_8 { width: calc(var(--boxSize) * 8); }
    div.c_0 { left: 0; } div.c_1 { left: var(--boxSize); } div.c_2 { left: calc(var(--boxSize) * 2); } div.c_3 { left: calc(var(--boxSize) * 3); }
    div.c_4 { left: calc(var(--boxSize) * 4); } div.c_5 { left: calc(var(--boxSize) * 5); } div.c_6 { left: calc(var(--boxSize) * 6); } div.c_7 { left: calc(var(--boxSize) * 7); } div.c_8 { left: calc(var(--boxSize) * 8); }
    div.r_0 { top: 0; } div.r_1 { top: var(--boxSize); } div.r_2 { top: calc(var(--boxSize) * 2); } div.r_3 { top: calc(var(--boxSize) * 3); }
    div.r_4 { top: calc(var(--boxSize) * 4); } div.r_5 { top: calc(var(--boxSize) * 5); } div.r_6 { top: calc(var(--boxSize) * 6); } div.r_7 { top: calc(var(--boxSize) * 7); }
    div.r_8 { top: calc(var(--boxSize) * 8); } div.r_9 { top: calc(var(--boxSize) * 9); } div.r_10 { top: calc(var(--boxSize) * 10); } div.r_11 { top: calc(var(--boxSize) * 11); }
    div.r_12 { top: calc(var(--boxSize) * 12); } div.r_13 { top: calc(var(--boxSize) * 13); } div.r_14 { top: calc(var(--boxSize) * 14); } div.r_15 { top: calc(var(--boxSize) * 15); }
</style>

<div class=@($"mu-item c_{this.Model.Column} r_{this.Model.Row} w_{this.Width} h_{this.Height}")>
    @if (this.Model.Item.Definition is null)
    {
        <div class="undefined-item"></div>
    }
    else
    {
        <img src=@($"_content/MUnique.OpenMU.Web.ItemEditor/img/items/item_{this.Model.Item.Definition.Group}_{this.Model.Item.Definition.Number}_{this.Model.EffectLevel}{this.Model.OptionSuffix}.png") alt=@this.Model.Item />
        @if (this.Model.Item.IsStackable() && this.Model.Item.Durability > 1)
        {
            <span class="item-amount-label">@this.Model.Item.Durability</span>
        }
        @if (this.Model.IsAncient)
        {
            <span class="indicator anc"></span>
        }
        @if (this.Model.IsExcellent)
        {
            <span class="indicator exc"></span>
        }
        @for (int i = 0; i < this.Model.Item.SocketCount; i++)
        {
            var socketEquipped = this.Model.Item.ItemOptions.Any(io => io.Index == i && io.ItemOption?.OptionType == ItemOptionTypes.SocketOption);
            <span class="indicator socket s@(i+1) @(socketEquipped ? "equipped" : "unequipped")"></span>
        }
    }
</div>

<div title=@this.Model.Item
    class=@($"mu-item {(this.IsSelected ? "highlighted" : "")} {(this._isDragging ? "dragging" : "")} mu-item-selector c_{this.Model.Column} r_{this.Model.Row} w_{this.Width} h_{this.Height}")
     @onclick="this.OnClick"
    tabindex="@(this.IsSelected ? 0 : -1)"
    autofocus="@(this.IsSelected ? "true" : null)" 
    @onkeydown="OnKeyPressAsync"></div>
@if (this.IsSelected && this.TotalRows > 0)
{
    <div
        class=@($"mu-item c_{this.Model.Column} r_{this.Model.Row} w_{this.Width} h_{this.Height}")
        tabindex="0"
        @onkeydown="OnKeyPressAsync">
    @if (CanMoveLeft)
    {
        <div class="mu-item-move-arrow left rounded-left" @onclick="MoveLeftAsync" alt="Press A to move left">
        </div>
    }

    @if (CanMoveRight)
    {
        <div class="mu-item-move-arrow right rounded-right" @onclick="MoveRightAsync" alt="Press D to move right">
        </div>
    }

    @if (CanMoveUp)
    {
        <div class="mu-item-move-arrow up rounded-top" @onclick="MoveUpAsync" alt="Press W to move up">
        </div>
    }

    @if (CanMoveDown)
    {
        <div class="mu-item-move-arrow down rounded-bottom" @onclick="MoveDownAsync" alt="Press S to move down">
        </div>
    }
    
    @if (!CanMoveUp && CanJumpUp)
    {
        <div class="mu-item-move-arrow up rounded-top jump" @onclick="JumpUpAsync" alt="Press W to move up">
        </div>
    }

    @if (!CanMoveDown && CanJumpDown)
    {
        <div class="mu-item-move-arrow down rounded-bottom jump" @onclick="JumpDownAsync" alt="Press S to move down">
        </div>
    }
    </div>
}
